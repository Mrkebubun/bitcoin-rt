<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Intro to WebSockets</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/showoff.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content cover" ref="sec1-overview/slides/1">
<h1>Intro to WebSockets</h1>

<h2>Chris Beams</h2>

<h2>Gunnar Hillert</h2>

<h2>Rossen Stoyanchev</h2>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="sec1-overview/slides/2">
<h1>Objective</h1>

<ul>
<li>Survey the lay of the land</li>
<li>Less focus on syntax and mechanics</li>
<li>Broad, pragmatic perspective</li>
<li>Special emphasis on Java</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content" ref="sec1-overview/slides/3">
<h1>This Presentation</h1>

<h2><a href="http://cbeams.github.com/bitcoin-rt">http://cbeams.github.com/bitcoin-rt</a></h2>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec1-overview/slides/4">
<h1>WebSocket 101</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/5">
<h1>The Problem</h1>

<ul>
<li>Some web apps need two-way communication / rapid updates</li>
<li>AJAX and Comet techniques can amount to an <br/>"abuse of HTTP"</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/6">
<h1>The Problem</h1>

<ul>
<li>Too many connections</li>
<li>Too much overhead</li>
<li>Too great a burden on the client</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/7">
<h1>The Usual Suspects</h1>

<ul>
<li>Trading</li>
<li>Chat</li>
<li>Gaming</li>
<li>Collaboration</li>
<li>Visualization</li>
</ul>


<p class="notes">:
* show Asana</p>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="sec1-overview/slides/8">
<h1>The Goal</h1>

<h2><em>"provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections"</em></h2>

<p>- <a href="http://www.ietf.org/rfc/rfc2616.txt">RFC 6455</a>, <i>The WebSocket Protocol</i></p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/9">
<h1>The Approach</h1>

<ul>
<li>Two-way messaging over a single connection</li>
<li>Layer on TCP</li>
<li>Not HTTP, but uses HTTP to bootstrap</li>
<li>Extremely low-overhead</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small" ref="sec1-overview/slides/10">
<h1>The WebSocket HTTP Handshake</h1>

<pre><code>GET /chat HTTP/1.1
Host: server.example.com
Upgrade: websocket
Connection: Upgrade

HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
</code></pre>

<p class="notes">:
TODO: use actual example from demos or from websockets.org
* mention something about original intent of 101/Upgrade, i.e. for upgrading
to newer versions of HTTP, not necessarily another protocol entirely.</p>
</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="sec1-overview/slides/11">
<h1>What's in a Frame?</h1>

<pre><code>     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-------+-+-------------+-------------------------------+
    |F|R|R|R| opcode|M| Payload len |    Extended payload length    |
    |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
    |N|V|V|V|       |S|             |   (if payload len==126/127)   |
    | |1|2|3|       |K|             |                               |
    +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
    |     Extended payload length continued, if payload len == 127  |
    + - - - - - - - - - - - - - - - +-------------------------------+
    |                               |Masking-key, if MASK set to 1  |
    +-------------------------------+-------------------------------+
    | Masking-key (continued)       |          Payload Data         |
    +-------------------------------- - - - - - - - - - - - - - - - +
    :                     Payload Data continued ...                :
    + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
    |                     Payload Data continued ...                |
    +---------------------------------------------------------------+
</code></pre>

<p><a href="http://www.ietf.org/rfc/rfc6455.txt">http://www.ietf.org/rfc/rfc6455.txt</a></p>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets incremental" ref="sec1-overview/slides/12">
<p> <img src="./file/sec1-overview/bitcoin.jpg" height="200"/></p>

<h1><code>bitcoin-rt</code></h1>

<ul>
<li>visualize <a href="http://weusecoins.com">Bitcoin</a> transactions in real time</li>
<li>inspired by original <a href="http://bitcoinmonitor.com">bitcoinmonitor.com</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/13">
<p><img src="./file/sec1-overview/bitcoinmonitor.png" alt="bitcoinmonitor.png"/></p>

<p class="notes">:
* briefly explain bitcoin
* actually show bitcoinmonitor, show long-polling with chrome dev tools
* start up</p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/14">
<h1><code>bitcoin-rt vs bitcoinmonitor</code></h1>

<ul>
<li>WebSockets instead of <a href="http://en.wikipedia.org/wiki/Push_technology#Long_polling">long polling</a></li>
<li><a href="http://d3js.org">d3.js</a> instead of <a href="http://jqueryui.com/">JQuery UI</a></li>
<li><a href="http://www.mongodb.org">MongoDB</a> for persistence</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/15">
<p><img src="./file/sec1-overview/bitcoin-rt.png" alt="bitcoin-rt.png"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="sec1-overview/slides/16">
<h1><code>bitcoin-rt</code> implementations</h1>

<ul>
<li><a href="http://nodejs.org">Node.js</a></li>
<li>Node.js + <a href="http://sockjs.org">SockJS</a></li>
<li>Java + <a href="http://tomcat.apache.org/tomcat-7.0-doc/web-socket-howto.html">Tomcat native WebSocket API</a></li>
<li>Java + <a href="https://github.com/Atmosphere/atmosphere#readme">Atmosphere</a></li>
<li>Java + <a href="http://vertx.io">Vert.x</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/17">
<p><img src="./file/sec1-overview/bitcoin-rt-source.png" alt="bitcoin-rt-source.png"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="sec1-overview/slides/18">
<h1>demo source</h1>

<h2><a href="http://github.com/cbeams/bitcoin-rt">http://github.com/cbeams/bitcoin-rt</a></h2>
</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec1-overview/slides/19">
<h1><code>bitcoin-rt: Node.js demo</code></h1>

<p class="notes">:
* show mongod running
* show client code</p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/20">
<h1>WebSocket benefits</h1>

<ul>
<li>more resource-efficient</li>
<li>lower-latency data</li>
<li>conceptually simpler</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec1-overview/slides/21">
<h1>if WebSocket is so great...</h1>

<ul>
<li>Why does bitcoinmonitor use long polling?</li>
<li>What about <a href="https://app.asana.com/0/2178923938044/2178923938044">other sites</a>?</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/22">
<h1>Browser Support</h1>

<p><img src="./file/sec1-overview/can-i-use-websockets.png" alt="can-i-use-websockets.png"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/23">
<h1>Browser Share World-Wide</h1>

<p><img src="./file/sec1-overview/browser-world-wide.jpg" alt="browser-world-wide.jpg"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/24">
<h1>Browser Share China</h1>

<p><img src="./file/sec1-overview/browser-china.jpg" alt="browser-china.jpg"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec1-overview/slides/25">
<h1>Browser Versions</h1>

<p><img src="./file/sec1-overview/browser-versions.jpg" alt="browser-version.jpg"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content small bullets incremental" ref="sec1-overview/slides/26">
<h1>HTTP Proxies</h1>

<ul>
<li>Content caching, internet connectivity, filtering</li>
<li>Can monitor or close connections, buffer unencrypted traffic</li>
<li>Designed for HTTP-based document transfer</li>
<li>Not for long-lived connections</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content quote" ref="sec1-overview/slides/27">
<h1>Proxy Traversal</h1>

<h2><em>"Today, most transparent proxy servers will not yet be familiar with the Web Socket protocol and these proxy servers will be unable to support the Web Socket protocol"</em></h2>

<p>- Peter Lubbers, in a 2010 <a href="http://www.infoq.com/articles/Web-Sockets-Proxy-Servers">InfoQ article</a></p>
</div>
</div><div class="slide" data-transition="none"><div class="content small bullets incremental" ref="sec1-overview/slides/28">
<h1>Proxy Issues</h1>

<ul>
<li>Explicit proxies with HTTP Connect</li>
<li>Transparent proxies propagation of <code>Upgrade</code> header</li>
<li>Retaining the <code>Connection</code> header</li>
<li>WebSocket frames vs HTTP traffic</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets incremental" ref="sec1-overview/slides/29">
<h1>A Few Rules of Thumb</h1>

<ul>
<li><code>"wss:"</code> provides a much better chance of success</li>
<li>Same for browsers using explicit proxies</li>
<li>Transparent proxies can support WebSocket<br> but must be configured explicitly</br>
</li>

</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small bullets incremental" ref="sec1-overview/slides/30">
<h1>Keeping Connections Alive</h1>

<ul>
<li>Internet inherently unreliable</li>
<li>Both server and client can go away</li>
<li>Wireless connection may fade out</li>
<li>and so on</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets incremental" ref="sec1-overview/slides/31">
<h1>A New Set of Challenges</h1>

<ul>
<li>Keep-alive ("ping!")</li>
<li>Heartbeat ("I'm still here!")</li>
<li>Message delivery guarantee</li>
<li>Buffering</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec2-history/slides/1">
<h1>How Did We Get Here?</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/2">
<h1>Some history...</h1>

<ul>
<li>1996 - Java Applets/Netscape 2.0</li>
<li>1999/2000 - XMLHttpRequest (XHR)</li>
<li>2003 - Macromedia/Adobe Flash (RTMP Protocol)</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec2-history/slides/3">
<p><img src="./file/sec2-history/comet-bleach.jpeg" alt="comet"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/4">
<h1>Comet</h1>

<ul>
<li>March 2006 - <strong>Comet</strong> - Alex Russell</li>
<li>event-driven, server-push data streaming</li>
<li>e.g. in GMail's GTalk interface</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/5">
<h1>Comet</h1>

<ul>
<li>XHR long-polling / XHR multipart-replace / XHR Streaming</li>
<li>htmlfile ActiveX Object</li>
<li>Server-sent events (SSE) - Part of HTML5/W3C (EventSource)</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/6">
<h1>Path to Websockets</h1>

<ul>
<li>2007 - TCPConnection API and protocol (Ian Hickson)</li>
<li>WebSocket - First public draft January 2008</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/7">
<h1>IETF Standardization</h1>

<h2>(Network Working Group)</h2>

<ul>
<li>2009-Jan - hixie-00</li>
<li>2010-Feb - hixie-75 - Chrome 4</li>
<li>2010-May - hixie-76 - Disabled in FF/Opera</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/8">
<h1>IETF Standardization</h1>

<h2>(HyBi Working Group)</h2>

<ul>
<li>2010-May - hybi-00 - Same as hixie-76</li>
<li>2011-April - hybi-07 - Firefox 6</li>
<li>2011-Dec - <strong>RFC6455</strong></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/9">
<h1>RFC 6455 - The WebSocket Protocol</h1>

<ul>
<li>Final Version: Dec 2011</li>
<li>http://tools.ietf.org/html/rfc6455</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/10">
<h1>Websocket Protocol Details</h1>

<ul>
<li>TCP-based protocol</li>
<li>HTTP used solely for upgrade request (Status Code <em>101</em>)</li>
<li>Bi-directional, full-duplex</li>
<li>Data Frames can be <strong>Text</strong> (UTF-8) or arbitrary <strong>Binary</strong> data</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content smaller" ref="sec2-history/slides/11">
<h1>Websocket Protocol Details</h1>

<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| opcode|M| Payload len |    Extended payload length    |
|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
|N|V|V|V|       |S|             |   (if payload len==126/127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len == 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+
</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/12">
<h1>Websocket Protocol Details</h1>

<ul>
<li><strong>FIN</strong> (1 bit) - Final fragment in a message</li>
<li><strong>RSV</strong>1-3 (1 bit each) - Reserved for extensions</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/13">
<h1>Websocket Protocol Details</h1>

<ul>
<li><strong>Opcode</strong> (4 bits) - Which type of payload</li>
<li>Text frame, binary frame, control frames</li>
<li>Continuation frame indicates data belongs to previous frame</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/14">
<h1>Websocket Protocol Details</h1>

<ul>
<li><strong>Mask</strong> (1 bit)</li>
<li>Clients must mask</li>
<li>Minimize data sniffing + Proxy cache-poisoning</li>
<li><strong>Masking-key</strong> (32bit) - Random (XOR) for each frame</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/15">
<h1>Websocket Protocol Details</h1>

<ul>
<li><strong>Payload length</strong> (7, 16 or 64 bit) in bytes</li>
<li><strong>Extension data</strong> + <strong>Application data</strong></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec2-history/slides/16">
<h1>Websocket Control Frames</h1>

<p><img src="./file/sec2-history/pong.png" alt="pong"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/17">
<h1>Websocket Control Frames</h1>

<ul>
<li><p>Communicate state about the WebSocket</p></li>
<li><p>Close (0x8)</p></li>
<li>Ping (0x9)</li>
<li><p>Pong (0xA)</p></li>
<li><p>More possible in future</p></li>
<li>125 bytes or less</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/18">
<h1>Close Frame</h1>

<ul>
<li>Terminates WebSocket connection</li>
<li>Can contain a body (UTF-8 encoded)</li>
<li>Defines a set of Status Codes, e.g:</li>
<li>1000 = normal closure</li>
<li>1001 = endpoint is "going away"</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/19">
<h1>Ping + Pong Frame</h1>

<ul>
<li>Serves as <strong>keepalive</strong> (Ping followed by Pong)</li>
<li>Check whether the remote endpoint is still responsive</li>
<li>Can be sent at any time (Websocket established, before close)</li>
<li>Just Pongs (unsolicited) = unidirectional <strong>heartbeat</strong></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/20">
<h1>WebSocket Schemes</h1>

<ul>
<li>Unencrypted: ws://</li>
<li>Encrypted: wss://</li>
<li>Use encrypted scheme</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/21">
<h1>Extensions</h1>

<ul>
<li>WebSocket Per-frame Compression (Draft)</li>
<li>Multiplexing Extension (Draft)</li>
<li>Extensions Header: Sec-WebSocket-Extensions</li>
<li>Used in the opening handshake (HTTP)</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/22">
<h1>Multiplexing Extension (MUX) for WebSockets</h1>

<ul>
<li><a href="http://tools.ietf.org/html/draft-ietf-hybi-websocket-multiplexing-08">http://tools.ietf.org/html/draft-ietf-hybi-websocket-multiplexing-08</a></li>
<li>separate logical connections over underlying transport connection</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/23">
<h1>Sub-Protocols</h1>

<ul>
<li>Sub-Protocol Header: Sec-WebSocket-Protocol</li>
<li>IANA Registry:</li>
<li><a href="http://www.iana.org/assignments/websocket/websocket.xml">http://www.iana.org/assignments/websocket/websocket.xml</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/24">
<h1>HTML5 WebSockets =</h1>

<h1>W3C API + IETF Protocol</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/25">
<h1>The WebSocket API</h1>

<ul>
<li>W3C Candidate Recommendation 20 Sep 2012</li>
<li><a href="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</a></li>
<li>Browser client-side API</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/26">
<h1>The WebSocket API</h1>

<ul>
<li>Binary data supported: <strong>Blob</strong> or <strong>ArrayBuffer</strong> format</li>
<li>Can inspect extensions (read-only)</li>
<li>No support for ping/pong frames</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/27">
<h1>The <em>readyState</em> attribute</h1>

<ul>
<li>CONNECTING (0) - Connection not yet established</li>
<li>OPEN (1) - Connection is established + communication possible</li>
<li>CLOSING (2) - Connection going through closing handshake / close() method called</li>
<li>CLOSED (3) - Connection is closed / could not be opened</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec2-history/slides/28">
<h1>Event Handlers</h1>

<ul>
<li>onopen</li>
<li>onmessage</li>
<li>onerror</li>
<li>onclose</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content" ref="sec2-history/slides/29">
<h1>Code Sample</h1>

<pre class="sh_java"><code>var socket = new WebSocket(
  'ws://localhost:8080/bitcoin-java-servlet/tomcat');
...
socket.onmessage = function(event) {
      console.log(event.data);
      var trade = JSON.parse(event.data);
      ...
    };
...</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content small bullets" ref="sec2-history/slides/30">
<h1>JSR 356: Java API for WebSocket</h1>

<ul>
<li>Early Draft Review, Sep 2012</li>
<li><a href="http://jcp.org/en/jsr/detail?id=356">http://jcp.org/en/jsr/detail?id=356</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec3-non-java/slides/1">
<h1>Non-Java Solutions</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="sec3-non-java/slides/2">
<h1>Node.js</h1>

<ul>
<li><a href="https://npmjs.org/package/websocket"><code>websocket</code> package</a></li>
<li><a href="http://socket.io/">Socket.IO</a></li>
<li><a href="http://sockjs.org">SockJS</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="sec3-non-java/slides/3">
<h1>More Than Just WebSockets</h1>

<ul>
<li>XHR streaming</li>
<li>XHR long polling</li>
<li>Hidden iframe</li>
<li>Flash socket</li>
<li>Polling</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec3-non-java/slides/4">
<h1>Socket.IO</h1>

<p><img src="./file/sec3-non-java/socketio.png" alt="socketio.png"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="sec3-non-java/slides/5">
<h1>SockJS Transports</h1>

<p><img src="./file/sec3-non-java/sockjs-transports.png" alt="sockjs-transports.png"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec3-non-java/slides/6">
<h1>Socket.IO vs SockJS</h1>

<ul>
<li><code>Socket.IO</code> more popular</li>
<li><code>SockJS</code> focused on transports, horizontal scalability</li>
<li><a href="https://groups.google.com/forum/#!topic/sockjs/lgzxVnlth54/discussion">Discussion thread</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec4-java/slides/1">
<h1>Where We Are In Java Land</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental bullets" ref="sec4-java/slides/2">
<h1><a href="http://tomcat.apache.org/tomcat-7.0-doc/web-socket-howto.html">Tomcat</a></h1>

<ul>
<li><code>WebSocketServlet</code></li>
<li>Since 7.0.27 (03/2012)</li>
<li>Backport to 6.0.35 <a href="https://issues.apache.org/bugzilla/show_bug.cgi?id=52918">Issue 52918</a></li>
<li>Fairly minimal, server-side only</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec4-java/slides/3">
<h1><code>bitcoin-rt: Tomcat demo</code></h1>

<p class="notes">:
* show mongod running
* show client code</p>
</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/4">
<h1><a href="http://download.eclipse.org/jetty/stable-7/apidocs/org/eclipse/jetty/websocket/package-summary.html">Jetty</a></h1>

<ul>
<li>Since Jetty 7.x (early adoption, complex)</li>
<li><a href="http://webtide.intalio.com/2012/10/jetty-9-updated-websocket-api/">Revised in Jetty 9</a></li>
<li>Builds on Java 7, messages not frames, annotations</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/5">
<h1><a href="http://antwerkz.com/glassfish-web-sockets-sample/">Glassfish</a></h1>

<ul>
<li>Since 3.1 (02/2011)</li>
<li>Exposes frames, server-side only</li>
<li>Like with earlier Jetty versions, a major revision is likely</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/6">
<h1>Other Implementations</h1>

<ul>
<li><a href="https://github.com/Atmosphere/atmosphere">Atmosphere</a></li>
<li><a href="http://jwebsocket.org">jWebSocket</a></li>
<li><a href="https://netty.io/">Netty</a></li>
<li><a href="http://vertx.io/">vert.x</a></li>
<li><a href="http://grizzly.java.net/">Grizzly</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/7">
<h1>Client Side</h1>

<ul>
<li><a href="https://github.com/sonatype/async-http-client">AsyncHttpClient</a></li>
<li>Jetty</li>
<li>Netty</li>
<li>vert.x</li>
<li>Grizzly</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/8">
<h1>Java API for WebSocket (JSR-356)</h1>

<ul>
<li>Original discussion started in JSR-340 (Servlet 3.1)</li>
<li>Later split out into separate spec</li>
<li>Servlet spec will have an upgrade option</li>
<li>JSR-356 will likely not depend on Servlet API</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/9">
<h1>What's under discussion</h1>

<ul>
<li>Client and server-side API</li>
<li>Use of annotations</li>
<li>Support for extensions</li>
<li>Security considerations</li>
<li>Thread model</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content small incremental bullets" ref="sec4-java/slides/10">
<h1>Resources</h1>

<ul>
<li><a href="http://java.net/projects/websocket-spec/downloads/directory/Spec%20javadoc%20Drafts">All drafts so far</a></li>
<li>The latest <a href="http://java.net/projects/websocket-spec/downloads/directory/Spec%20javadoc%20Drafts/v006-EDR">v006 early draft review</a></li>
<li><a href="http://java.net/projects/websocket-spec/lists">Mailing list archives</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content subsection" ref="sec5-non-trivial/slides/1">
<h1>Building a Non-Trivial Application</h1>

<p class="notes">: 15 min</p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec5-non-trivial/slides/2">
<h1>A Few Conclusions</h1>

<ul>
<li>WebSocket technology is promising</li>
<li>Not a silver bullet</li>
<li>Complement to REST</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec5-non-trivial/slides/3">
<h1>A Few Conclusions</h1>

<ul>
<li>Potential replacement for Comet techniques</li>
<li>But the need for fallback options will persist</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec5-non-trivial/slides/4">
<h1>A Few Conclusions</h1>

<ul>
<li>Integrating WebSockets into a real app is not yet trivial</li>
<li>But now is the time to begin thinking about it</li>
<li>"Pure WebSocket" applications in the wild unlikely</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec5-non-trivial/slides/5">
<h1>Predictions</h1>

<ul>
<li>A consolidation of 'fallback protocols'</li>
<li>Leading to wide adoption in various application frameworks</li>
<li>SockJS currently the most <a href="https://github.com/sockjs/sockjs-protocol">promising effort</a></li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="sec5-non-trivial/slides/6">
<h1>Many questions remain</h1>

<ul>
<li>usage patterns</li>
<li>higher-level protocols</li>
<li>XMPP, AMQP, JMS</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="sec5-non-trivial/slides/7">
<h1>Building a real app today</h1>

<ul>
<li>Commercial vendors have a lot to offer</li>
<li>Particularly <img src="./file/sec5-non-trivial/kaazing-logo.png" alt="kaazing-logo.png"/> (<a href="http://blog.kaazing.com">blog</a>, <a href="http://www.websocket.org/">websocket.org</a>)</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="sec5-non-trivial/slides/8">
<h1>Predictions: Java</h1>

<ul>
<li>JSR-356 will be important</li>
<li>Frameworks have a big role to play</li>
<li>Atmosphere is there today</li>
<li>Dedicated Spring support in consideration</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="sec5-non-trivial/slides/9">
<h1>More Info</h1>

<ul>
<li>Jeremy Grelle's Async session @2:45p</li>
</ul>

</div>
</div><div class="slide" data-transition="none"><div class="content subsection bullets" ref="sec7-end/slides">
<h1>Thanks! Questions?</h1>

<ul>
<li><a href="http://twitter.com/cbeams">@cbeams</a> | <a href="http://twitter.com/ghillert">@ghillert</a> | <a href="http://twitter.com/rstoya05">@rstoya05</a></li>
<li><a href="http://cbeams.github.com/bitcoin-rt">http://cbeams.github.com/bitcoin-rt</a></li>
</ul>

</div>
</div></div>

</body>
</html>
